<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <!-- The above 3 meta tags *must* come first in the head; any other head content must come *after* these tags -->
    <title>设备管理</title>

    <!-- Bootstrap -->
    <link href="css/bootstrap.min.css" rel="stylesheet">

    <!-- HTML5 shim and Respond.js for IE8 support of HTML5 elements and media queries -->
    <!-- WARNING: Respond.js doesn't work if you view the page via file:// -->
    <!--[if lt IE 9]>
      <script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
      <script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
    <![endif]-->
    <style type="text/css">
      #name-farm::-webkit-input-placeholder {
        color: blue;
        font-size: 18px;
      }
      .luck-ping-body {
        background-color: #eee;
      }
      .luck-ping-div {
        margin-top: 18px;
        margin-bottom: 10px;
        padding: 5px 10px 5px 10px; 
      }
      .luck-ping-p1 {
        margin: 10px;
        padding: 0px;
        font-size: 16px;
        border:none;
      }       
      .luck-ping-p2 {
        margin: 0px;
        padding: 0px;
        font-size: 11px;
      }
      .luck-ping-div2 {
        width:200px;
        padding-left: 10px;
    
      }                    
    </style>     
  </head>
  <body class="luck-ping-body">

    <div class="container">
      <div class="btn-group btn-group-justified" role="group" aria-label="...">
        <div class="btn-group" role="group">
          <a href="qr-code.html">
            <img src="img/img_btn_add_small.png" />
          </a>
        </div>
        <div class="btn-group" role="group">
          <a href="farm-avatar.html">
            <img src="img/img_default_garden.png" class="img-circle" />
          </a>
        </div>
        <div class="btn-group" role="group">
          <img src="img/img_control_switcher.png" id="myButton" class="img-responsive center-block" />
        </div>
      </div>
    </div>

    <ul class="list-group">
  		<li class="list-group-item" style="background-color: #eee;">
        <div class="container">
          <ul class="list-inline">
            <li>
              <a href="device.html">
                <img src="img/img_device_default.png" />
              </a>
            </li> 
            <li><p>设备1</p></li>
            <li style="float:right;margin-top:30px;"><img src="img/img_indicator_online.png" /></li>
          </ul>
        </div>


        <li class="list-group-item" style="background-color: #eee;">
          <ul class="list-inline">
            <li><img id="indicator_01" src="img/img_indicator_happy.png" /></li>
            <li><p>温度</p></li>
            <li>
              <input type="button" id="b01" type="button" class="btn btn-default" onclick='start1();' value="通风降温" style="width:80px; font-size:13px;" />
            </li>
            <li>
              <progress id="p01" value="0" max="100" style="width:100px;height:18px;">
            </li>
            <li>
              <input type="button" class="btn btn-default" onclick='start1();' value="加温升温" style="width:80px; font-size:13px;"/>
            </li>
          </ul>
        </li>
        <li class="list-group-item" style="background-color: #eee;">
          <ul class="list-inline">
            <li><img id="indicator_02" src="img/img_indicator_happy.png" /></li>
            <li><p>湿度</p></li>
            <li>
              <input type="button" class="btn btn-default" onclick='start2();' value="浇水" style="width:80px;font-size:13px;" />
            </li>
            <li>
              <progress id="p02" value="0" max="100" style="width:100px;height:18px;">
            </li>
          </ul>
        </li>
        <li class="list-group-item" style="background-color: #eee;">
          <ul class="list-inline">
            <li><img id="indicator_03" src="img/img_indicator_happy.png" /></li>
            <li><p>光照</p></li>
            <li>
              <input  type="button" class="btn btn-default" onclick='start3();' value="增加光照" style="width:80px;font-size:13px;" />
            </li>
            <li>
              <progress id="p03" value="0" max="100" style="width:100px;height:18px;">
            </li>
          </ul>
        </li>
        <li class="list-group-item" style="background-color: #eee;">
          <ul class="list-inline">
            <li><img src="img/img_indicator_sad.png" /></li>
            <li><p>水位</p></li>
            <li><p>请您亲自浇水</p></li>
          </ul>
        </li>                           
      </ul>



  		<li class="list-group-item">
        <div class="container">
          <ul class="list-inline">
            <li><img src="img/img_device_default.png" /></li>   
            <li><p>设备2</p></li>
            <li><img src="img/img_indicator_offline.png" /></li>
          </ul>
        </div>

        <ul class="list-group">
          <li class="list-group-item">
            <ul class="list-inline">
              <li><img src="img/img_indicator_happy.png" /></li>
              <li><p>温度</p></li>
              <li><button type="button" class="btn btn-default" onclick="start('p0x');">通风降温</button></li>
              <li>
                <progress id="p0x" value="22" max="100" style="width:4.8em;height:18px;">
              </li>
              <li><button type="button" class="btn btn-default" onclick="start('p0x');">加温升温</button></li>
            </ul>
          </li>
          <li class="list-group-item">
            <ul class="list-inline">
              <li><img src="img/img_indicator_happy.png" /></li>
              <li><p>湿度</p></li>
              <li><button type="button" class="btn btn-default">浇水</button></li>
              <li>
                <progress value="22" max="100">
              </li>
            </ul>
          </li>
          <li class="list-group-item">
            <ul class="list-inline">
              <li><img src="img/img_indicator_happy.png" /></li>
              <li><p>光照</p></li>
              <li><button type="button" class="btn btn-default">增加光照</button></li>
              <li>
                <progress value="22" max="100">
              </li>
            </ul>
          </li>
          <li class="list-group-item">
            <ul class="list-inline">
              <li><img src="img/img_indicator_sad.png" /></li>
              <li><p>水位</p></li>
              <li><p>请您亲自浇水</p></li>
            </ul>
          </li>                           
        </ul>
      </li>
    </ul>

    <!-- jQuery (necessary for Bootstrap's JavaScript plugins) -->
    <script src="js/jquery-3.1.1.js"></script>
    <!-- Include all compiled plugins (below), or include individual files as needed -->
    <script src="js/bootstrap.min.js"></script>
    <script type="text/javascript">
    var testBool = 0;
    function getIndicatorImg(id){
      //alert("work on me");
      $.ajax({
              url: 'http://localhost:8888',
              type: 'get',
              dataType: 'json',
              cache: false,
              timeout: 5000,
              success: function(data){
                  //alert(data);
                  if(testBool == 0) {
                    document.getElementById(id).src="img/img_indicator_happy.png";
                    testBool = 1;
                  } else {
                    document.getElementById(id).src="img/img_indicator_sad.png";
                    testBool = 0;
                  }
                  
              },
              error: function(jqXHR, textStatus, errorThrown){
                  alert('error ' + textStatus + " " + errorThrown);  
              }
          });

      setTimeout(function() {
        getIndicatorImg(id)
      }, 1000);
    }

		var c=0;
		var t;

    function timedCount(id) {
      //alert(id);
      document.getElementById(id).value = c;
      c = c+1;
      t = setTimeout(function() {
        timedCount(id);
      }, 1000);
      if(c==100) {
        clearTimeout(t);
      }
    }
    function start(id) {
      clearTimeout(t);
      c=0;
      timedCount(id);
    }

		function timedCount1() {
			document.getElementById("p01").value = c;
			c = c+1;
			t = setTimeout("timedCount1()", 1000);
			if(c==100) {
				clearTimeout(t);
			}
		}
		function start1() {
			clearTimeout(t);
			c=0;
			timedCount1();
		}
		function timedCount2() {
			document.getElementById("p02").value = c;
			c = c+1;
			t = setTimeout("timedCount2()", 1000);
			if(c==100) {
				clearTimeout(t);
			}			
		}
		function start2() {
			clearTimeout(t);
			c=0;
			timedCount2();
		}
		function timedCount3() {
			document.getElementById("p03").value = c;
			c = c+1;
			t = setTimeout("timedCount3()", 1000);
			if(c==100) {
				clearTimeout(t);
			}			
		}	
		function start3() {
			clearTimeout(t);
			c=0;
			timedCount3();
		}
      
    var mode = 0;
    $("#myButton").on('click', function() {
      var btn = document.getElementById("myButton")

      $.ajax({
              url: 'http://localhost:8888',
              type: 'get',
              data: {"mode":mode},
              dataType: 'json',
              cache: false,
              timeout: 5000,
              success: function(data){
                //alert(data);
                if (data.data == 0) {
                  btn.src="img/img_control_switcher.png"
                } else {
                  btn.src="img/img_control_switcher_manual.png"
                }
                mode = data.data
                  
              },
              error: function(jqXHR, textStatus, errorThrown){
                  alert('error ' + textStatus + " " + errorThrown);  
              }
          });

    })

    window.onload = function() {
      /*
      var test = new Array('indicator_01', 'indicator_02','indicator_03')
      for(var i=0;i<test.length;i++) {
        getIndicatorImg(test[i])
      }
      */
      
    }
    </script>
  </body>
</html>